{"debug_id":"64e3d396-5366-52f3-9651-760d9dcc68a8","file":"play.js","mappings":"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","names":[],"sourceRoot":"/","sources":["src/commands/music/play.ts"],"sourcesContent":["import { Command, KATClient as Client, Commander, MusicPrompts, NodeError, PlayerError, SearchError } from '@structures/index.js';\nimport { SlashCommandBuilder, ChatInputCommandInteraction, GuildMember, VoiceChannel } from 'discord.js';\nimport { ActionEmbed, ErrorEmbed, MusicEmbed } from '@utils/embeds/index.js';\nimport { PromptBuilder } from '@utils/prompt.js';\n\nexport class PlayCommand extends Command {\n    constructor(client: Client, commander: Commander) {\n        super(client, commander, {\n            name: 'play',\n            module: 'Music',\n            // Remove when shifting to slash commands.\n            aliases: ['p'],\n            description: {\n                content: 'Add a track to the queue, or resume the current one.',\n                format: '<?title/url>',\n            },\n            cooldown: 5,\n            ephemeral: true,\n        });\n    }\n\n    data() {\n        return new SlashCommandBuilder()\n            .setName(this.name)\n            .setDescription(this.description?.content!)\n            .setDMPermission(false)\n            .addStringOption((option) => option.setName('query').setDescription('The name or URL of the track to search for.'));\n    }\n\n    async execute(int: ChatInputCommandInteraction<'cached'>) {\n        const query = int.options.getString('query');\n\n        const voiceChannel = (int.member as GuildMember).voice.channel;\n        if (!voiceChannel) return int.editReply({ embeds: [new ActionEmbed('fail').setText(MusicPrompts.NotInVoice)] });\n        if (!(voiceChannel instanceof VoiceChannel)) return int.editReply({ embeds: [new ActionEmbed('fail').setText(MusicPrompts.IncorrectVoice)] });\n        if (!voiceChannel.joinable || !voiceChannel.speakable)\n            return int.editReply({ embeds: [new ActionEmbed('fail').setText(MusicPrompts.CannotPlayInVoice)] });\n\n        if (!query) {\n            const subscription = this.client.dispatcher.getSubscription(int.guild);\n            if (!subscription?.paused) return int.editReply({ content: 'What should I play?' });\n\n            this.applyCooldown(int.user);\n\n            subscription.resume();\n\n            return int.editReply({ content: '▶️ Track Resumed.' });\n        }\n\n        this.applyCooldown(int.user);\n\n        try {\n            const res = await this.client.dispatcher.search(query, int.user);\n            if (!res) return int.editReply({ embeds: [new ActionEmbed('fail').setText(MusicPrompts.NoResults)] });\n\n            const subscription = await this.client.dispatcher.createSubscription(int.guild, voiceChannel, int.channel!);\n            subscription.add(res);\n\n            int.editReply({ content: new PromptBuilder(subscription).setEnqueued(res) });\n        } catch (err) {\n            if (err instanceof NodeError) {\n                return int.editReply({ embeds: [new ActionEmbed('fail').setText(MusicPrompts.NoNodes)] });\n            } else if (err instanceof SearchError && err.code == 1) {\n                return int.editReply({ embeds: [new ActionEmbed('fail').setText(`Failed to load track! \\n\\`${err.message}\\``)] });\n            } else if (err instanceof PlayerError) {\n                return int.editReply({ embeds: [new ActionEmbed('fail').setText(MusicPrompts.VoiceError)] });\n            } else {\n                const eventId = this.client.logger.error(err);\n                return int.editReply({ embeds: [new ErrorEmbed(eventId)] });\n            }\n        }\n    }\n}\n"],"version":3}